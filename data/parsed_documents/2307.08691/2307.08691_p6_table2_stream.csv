"8:","","On chip, compute S( ğ‘— )
ğ‘–","= Qğ‘–Kğ‘‡","ğ‘— âˆˆ Rğµğ‘Ÿ Ã—ğµğ‘ .","","",""
"9:","On chip,","compute ğ‘š ( ğ‘— )","","= max(ğ‘š ( ğ‘— âˆ’1)","",", rowmax(S( ğ‘— )","))"
"","","ğ‘–","","ğ‘–","","ğ‘–",""
"","","","âˆ’ğ‘š( ğ‘—)","","","",""
"","(pointwise), â„“ ( ğ‘— )","= ğ‘’ğ‘š ğ‘— âˆ’1","ğ‘–
â„“ ( ğ‘— âˆ’1)","","+ rowsum( ËœP( ğ‘— )","",") âˆˆ Rğµğ‘Ÿ ."
"","","ğ‘–","ğ‘–","","","ğ‘–",""
"","","","","","âˆ’ğ‘š( ğ‘—)","",""
"10:","","On chip, compute O( ğ‘— )
ğ‘–","","= diag(ğ‘’ğ‘š( ğ‘— âˆ’1)","ğ‘–",") âˆ’1O( ğ‘— âˆ’1)
ğ‘–","+ ËœP( ğ‘— )
ğ‘–"
"11:","end for","","","","","",""
"12:","","On chip, compute Oğ‘– = diag(â„“ (ğ‘‡ğ‘ )","",") âˆ’1O(ğ‘‡ğ‘ )",".","",""
"","","","ğ‘–","ğ‘–","","",""
"13:","","On chip, compute ğ¿ğ‘– = ğ‘š (ğ‘‡ğ‘ )","ğ‘–","+ log(â„“ (ğ‘‡ğ‘ )
ğ‘–",").","",""
"14:","Write Oğ‘–","to HBM as the ğ‘–-th block of O.","","","","",""
"15:","Write ğ¿ğ‘–","to HBM as the ğ‘–-th block of ğ¿.","","","","",""
"16: end for","","","","","","",""
"17: Return the output O and the logsumexp ğ¿.","","","","","","",""
