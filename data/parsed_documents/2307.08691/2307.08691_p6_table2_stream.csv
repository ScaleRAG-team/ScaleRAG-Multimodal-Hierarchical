"8:","","On chip, compute S( 𝑗 )
𝑖","= Q𝑖K𝑇","𝑗 ∈ R𝐵𝑟 ×𝐵𝑐 .","","",""
"9:","On chip,","compute 𝑚 ( 𝑗 )","","= max(𝑚 ( 𝑗 −1)","",", rowmax(S( 𝑗 )","))"
"","","𝑖","","𝑖","","𝑖",""
"","","","−𝑚( 𝑗)","","","",""
"","(pointwise), ℓ ( 𝑗 )","= 𝑒𝑚 𝑗 −1","𝑖
ℓ ( 𝑗 −1)","","+ rowsum( ˜P( 𝑗 )","",") ∈ R𝐵𝑟 ."
"","","𝑖","𝑖","","","𝑖",""
"","","","","","−𝑚( 𝑗)","",""
"10:","","On chip, compute O( 𝑗 )
𝑖","","= diag(𝑒𝑚( 𝑗 −1)","𝑖",") −1O( 𝑗 −1)
𝑖","+ ˜P( 𝑗 )
𝑖"
"11:","end for","","","","","",""
"12:","","On chip, compute O𝑖 = diag(ℓ (𝑇𝑐 )","",") −1O(𝑇𝑐 )",".","",""
"","","","𝑖","𝑖","","",""
"13:","","On chip, compute 𝐿𝑖 = 𝑚 (𝑇𝑐 )","𝑖","+ log(ℓ (𝑇𝑐 )
𝑖",").","",""
"14:","Write O𝑖","to HBM as the 𝑖-th block of O.","","","","",""
"15:","Write 𝐿𝑖","to HBM as the 𝑖-th block of 𝐿.","","","","",""
"16: end for","","","","","","",""
"17: Return the output O and the logsumexp 𝐿.","","","","","","",""
